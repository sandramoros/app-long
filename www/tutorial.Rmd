---
title: 'Tutorial: Aplicaci칩n Shiny para el an치lisis de estudio precl칤nicos'
subtitle: Analiza tus datos con estos sencillos pasos
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    df_print: paged
  pdf_document:
    toc: true
    toc_depth: '3'
---

# **Introducci칩n**

Esta aplicaci칩n ha sido desarrollada para facilitar el ajuste de **modelos estad칤sticos**: en funci칩n del n칰mero de *timepoints* a analizar se ajusta:

- Un modelo lineal simple (`lm()`) si solo hay un *timepoint*.

- Modelos lineales de efectos mixtos (`lmer()` o `lme()`) si hay dos o m치s *timepoints*, permitiendo as칤 modelar la variabilidad entre sujetos."


La aplicaci칩n permite:

九덢잺 Cargar un archivo Excel con los datos experimentales, en formato *wide* o *long*.

九덢잺 Seleccionar grupos y *timepoints* para comparar.  

九덢잺 Ajustar un modelo usando `lm()`, `lmer()` o `lme()`, seg칰n corresponda.

九덢잺 Visualizar los resultados, incluyendo gr치ficos.

九덢잺 Descargar informes (Excel y HTML).

---

# **Carga de datos**

La aplicaci칩n acepta **archivos Excel (.xlsx)** con datos en dos formatos posibles, *wide* o *long*. En **Plantilla de descarga** se pueden decargar las dos plantillas para rellenarlas con los datos del usuario.

## Formato Wide

| ID_sujeto | ID_grupo | Nombre_grupo | Nombre_variable | Valor_timepoint1 | Valor_timepoint2 | ... |
|-----------|-----------|----------------|------------------|--------------------|--------------------|-----|
| 1.1       | A         | control        | nAb              | 1.30               | 1.35               | ... |
| 1.2       | A         | control        | nAb              | 1.35               | 1.30               | ... |
| ---       | ---       | ---            | ---              | ---                | ---                | ... |
| 2.1       | B         | tratado        | nAb              | 1.40               | 2.60               | ... |
| 2.2       | B         | tratado        | nAb              | 1.30               | 2.70               | ... |
| ---       | ---       | ---            | ---              | ---                | ---                | ... |
| 1.1       | A         | control        | IgG              | 1.35               | 1.45               | ... |
| 1.2       | A         | control        | IgG              | 1.30               | 1.40               | ... |
| ---       | ---       | ---            | ---              | ---                | ---                | ... |
| 2.1       | B         | tratado        | IgG              | 1.40               | 2.90               | ... |
| 2.2       | B         | tratado        | IgG              | 1.30               | 2.85               | ... |


游늷 En este formato, cada columna "Valor_timepointX" representa una medida temporal diferente. Puede cambiarse el nombre por algo m치s descriptivo como "D0, D14, D30..." -d칤a- o "M0, M1, M3, M6..." -mes-. SIEMPRE incluir un n칰mero en el nombre poner las columnas en orden cronol칩gico.


## Formato Long

| ID_sujeto | ID_grupo | Nombre_grupo | Nombre_variable | Timepoint | Valores_variable |
|-----------|-----------|----------------|------------------|-----------|------------------|
| 1.1       | A         | control        | nAb              | 1         | 1.30             |
| 1.1       | A         | control        | nAb              | 2         | 1.35             |
| 1.2       | A         | control        | nAb              | 1         | 1.35             |
| 1.2       | A         | control        | nAb              | 2         | 1.30             |
| ---       | ---       | ---            | ---              | ---       | ---              |
| 2.1       | B         | tratado        | nAb              | 1         | 1.40             |
| 2.1       | B         | tratado        | nAb              | 2         | 2.60             |
| 2.2       | B         | tratado        | nAb              | 1         | 1.30             |
| 2.2       | B         | tratado        | nAb              | 2         | 2.70             |
| ---       | ---       | ---            | ---              | ---       | ---              |
| 1.1       | A         | control        | IgG              | 1         | 1.35             |
| 1.1       | A         | control        | IgG              | 2         | 1.45             |
| 1.2       | A         | control        | IgG              | 1         | 1.30             |
| 1.2       | A         | control        | IgG              | 2         | 1.40             |
| ---       | ---       | ---            | ---              | ---       | ---              |
| 2.1       | B         | tratado        | IgG              | 1         | 1.40             |
| 2.1       | B         | tratado        | IgG              | 2         | 2.90             |
| 2.2       | B         | tratado        | IgG              | 1         | 1.30             |
| 2.2       | B         | tratado        | IgG              | 2         | 2.85             |
| ---       | ---       | ---            | ---              | ---       | ---              |


游늷 En este formato, la columna "Timepoint" indica el momento temporal. SIEMPRE incluir un n칰mero en el nombre (por ejemplo: 1, 15, 30 o D1, D15, D30).

En cuanto a las variales respuesta, habr치 tantas columnas "Valores_variable" como variables se quieran analizar. Se les puede dar un nombre descriptivo, por ejemplo "nAb" o "IgG".

    仇듈mportante: la aplicaci칩n usar치 la variable "ID_grupo" para ajustar los modelos. La variable "Nombre_grupo" es solo informativa para el investigador, por si quiere asociar una descripci칩n al c칩digo del grupo, que habitualmente suele ser algo corto como "A, B, C..." o "1, 2, 3...".
    
    仇듈mportante: si falta alguna observaci칩n en alg칰n sujeto, dejar la celda vac칤a o bien escribir NA y la aplicaci칩n lo interpretar치 como un dato faltante.

---

# **Selecci칩n de par치metros (men칰 lateral)**


## Cargar el archivo Excel

1. Haz clic en **"Cargar tus datos (archivo Excel)"**. La aplicaci칩n reconocer치 si est치 en formato *wide* o *long*.

2. La aplicaci칩n mostrar치 una previsualizaci칩n de los datos cargados. Puedes elegir cu치ntos decimales visualizar.


## Seleccionar los *timepoints* y variable a analizar

1. Selecciona qu칠 *timepoints* se quieren analizar en **Selecciona timepoints**. Si se elige uno, la aplicaci칩n usar치 `lm()`. Si se eligen dos o m치s, se podr치 hacer `lmer()` o `lme()`.

2. Elige qu칠 variable quieres analizar en **Selecciona la variable de inter칠s**. Esta selecci칩n estar치 disponible cuando se carguen los datos.


## Definir el modo de comparaci칩n de los grupos

1. Define c칩mo comparar los grupos en **Modo de comparaci칩n de grupos**:

    **"Todos contra todos"**: Compara todos los grupos entre s칤.

      游눠 Nota: si solo hay dos grupos, elige este modo.

    **"Todos contra control"**: Compara cada grupo con el grupo control seleccionado.

2. Selecciona los grupos en **Selecciona grupos para comparar**. Si has elegido "Todos contra control" aparecer치 una nueva casilla **Selecciona el grupo control**.


## Definir el modelo

Si se ha elegido un *timepoint*:

1. Elige el **M칠todo de correcci칩n de p-value (pruebas post hoc))** para las m칰ltiples comparativas entre grupos.


Si se ha elegido m치s de un *timepoint*:

1. Se puede clicar en la casilla **Realizar an치lisis de homocedasticidad** para orientarse entre elegir `lmer()` o `lme()`.
Si hay homocedasticidad, en **Selecciona el modelo a utilizar** se puede optar por **Modelo mixto `lmer()`**.

2. Si no se cumple el supuesto de homocedasticidad, en **Selecciona el modelo a utilizar** se puede optar por **Modelo mixto con varianza `lme()`** y entonces aparecer치n dos selectores para elegir la **Estructura de correlaci칩n entre residuos** y la **Estructura de la varianza residual**.

    游늸 Ejemplo pr치ctico:
    
    Imagina que se mide el t칤tulo de anticuerpos neutralizantes en individuos vacunados con diferentes vacunas en 3 momentos: d칤a 0, d칤a 14 y d칤a 60. Es razonable asumir que las mediciones de un mismo animal est치n correlacionadas entre s칤, especialmente entre puntos cercanos en el tiempo.
    
    2.1 Estructura de correlaci칩n entre residuos: sirve para modelar las observaciones repetidas de un mismo sujeto a lo largo del tiempo, cuando est치n correlacionadas entre s칤 (es decir, no son independientes).

      - AR(1) (`corAR1`): asume que las mediciones repetidas de un mismo sujeto est치n correlacionadas, y que esta correlaci칩n disminuye cuanto m치s separadas est칠n en el tiempo. En el ejemplo, entre d칤a 0 y d칤a 14 habr칤a una correlaci칩n alta, pero entre d칤a 0 y d칤a 60 ser칤a baja y entre d칤a 14 y d칤a 60 ser칤a media. Sin embargo, es conveniente aplicar esta opci칩n solo cuando los tiempos est치n equiespaciados.
      
      - ARMA(1,1) (`corARMA`): es una extensi칩n de AR(1) que permite modelar patrones m치s complejos de correlaci칩n. En el ejemplo, ser칤a 칰til si el t칤tulo de anticuerpos no sigue una progresi칩n suave, sino que presenta fluctuaciones o rebotes inesperados entre visitas.
    
      - Simetr칤a compuesta (`corCompSymm`): supone que todas las mediciones de un sujeto est치n igualmente correlacionadas entre s칤, sin importar el tiempo. Es 칰til cuando hay pocos *timepoints*. En el ejemplo, se ver칤a una respuesta de anticuerpos muy estable a lo largo del tiempo, sin evidencias de que el d칤a 14 est칠 m치s relacionado con el d칤a 0 que con el d칤a 60. 
    
      - Correlaci칩n arbitraria (`corSymm`): permite que cada par de *timepoints* tenga una correlaci칩n distinta, sin ning칰n patr칩n predefinido. Por ejemplo, el d칤a 14 y el d칤a 60 est치n muy relacionados, pero ambos poco con d칤a 0. Al ser tan flexible requiere m치s datos.
    
    Tambi칠n hay la opci칩n de elegir Ninguna y entonces el modelo no considera ninguna correlaci칩n entre mediciones del mismo sujeto. Solo se recomienda si se ha verificado que los residuos son independientes, lo cual es raro en estudios longitudinales.
    
    
    2.2 Estructura de la varianza residual: modelar la varibilidad de los residuos es 칰til cuando se sospecha que la varianza no es constante entre grupos o a lo largo del tiempo (es decir, que existe **heterocedasticidad**).
    
      - `varIdent por grupo`: permite que cada grupo tenga una varianza distinta en los residuos. Por ejemplo, los t칤tulos de anticuerpos en el grupo vacuna A son muy homog칠neos (varianza baja), pero en el grupo vacuna B hay mucha variabilidad entre sujetos.
    
      - `varIdent por timepoint`: permite que la varianza cambie con el tiempo, igual para todos los grupos.Por ejemplo, en el d칤a 0, todos los sujetos tienen valores similares (poca variabilidad) pero en el d칤a 60, los valores est치n mucho m치s dispersos.
    
      - `varIdent por grupo y timepoint`: permite que cada combinaci칩n de grupo y momento temporal tenga su propia varianza. Por ejemplo, el grupo vacuna A es muy estable en todos los *timepoints*, pero el grupo vacuna B tiene poca variabilidad al inicio, pero es muy variable a los 60 d칤as.
    
      - `varPower`: modela que la varianza depende del valor medio estimado del modelo. Cuanto mayor sea el valor predicho, mayor (o menor) puede ser la varianza residual. Por ejemplo, los individuos con t칤tulos de anticuerpos m치s altos presentan tambi칠n mayor variabilidad entre ellos, es decir las respuestas bajas son muy homog칠neas, pero las m치s altas son muy dispersas.
    
      - `varConstPower`: permite una combinaci칩n entre una varianza constante y una parte proporcional al valor medio estimado. Por ejemplo, hay una variabilidad base com칰n en todos los sujetos, pero a medida que los valores aumentan, tambi칠n lo hace la dispersi칩n (aunque no completamente proporcional).
    
    Tambi칠n hay la opci칩n de elegir Ninguna y entonces no se modela ninguna estructura especial: se asume homocedasticidad (misma varianza residual para todos los casos).

3. Elige si **Incluir Interacci칩n**. Al seleccionas la opci칩n "S칤", se est치 indicando que el modelo debe tener en cuenta no solo los efectos principales de grupo y tiempo, sino tambi칠n c칩mo se combinan entre s칤.
  
    游늸 Ejemplo pr치ctico:
    
    Se analizan los t칤tulos de anticuerpos en tres *timepoints* (d칤a 0, 14 y 60) para dos vacunas distintas (grupo A y grupo B).
    
    Si se incluye la interacci칩n grupo * tiempo, el modelo podr치 detectar comportamientos como estos:
    
      - La vacuna A sube mucho a los 14 d칤as y luego se mantiene.
    
      - La vacuna B sube poco a los 14 d칤as pero sigue subiendo hasta el d칤a 60.
    
    Si no se incluye la interacci칩n esto no se detectar칤a porque se asume que todos los grupos evolucionan igual en el tiempo.
    
    En el caso de que el test de interacci칩n no muestre significancia no ser칤a necesar칤a incorporarla (se puede comprobar en la tabla del modelo).
      
    游눠 Nota: grupo * tiempo equivale a grupo + tiempo + grupo:tiempo.

4. Por 칰ltimo, elige el **M칠todo de correcci칩n de p-value (pruebas post hoc))** para las m칰ltiples comparativas entre grupos.


## Ejecutar el an치lisis

1. Haz clic en **"Realizar an치lisis"**. Podr치s ver en las distintas pesta침as los resultados.


## Exportaci칩n de resultados

1. Para descargar los resultados en Excel (no incluye gr치ficos), haz clic en **Descargar informe Excel**.

2. Para descargar los resultados en HTML (incluy gr치ficos), haz clic en **Descargar informe HTML"**.


---

# **Interpretaci칩n de resultados (pesta침as)**

Tenemos las pesta침as de:

## Datos cargados

Se visualizan los datos que se han subido a la aplicaci칩n. Se puede seleccionar cu치ntos ver por p치gina y dispone tambi칠n de un buscador.


## Datos procesados

Se visualiza el procesado de los datos (si estaban en formato *wide* se ha pasado a *long*). Se puede seleccionar cu치ntos ver por p치gina y dispone tambi칠n de un buscador.


## Gr치fica de los datos

Si solo se selecci칩na un *timepoint* se muestra un *boxplot* con la distribuci칩n de la variable seleccionada por grupo. Si se selecciona m치s de un *timepoint*, se muestra una gr치fica con la evoluci칩n de la variable seleccionada por grupo a lo largo del tiempo.


## Modelo

Se muestra la f칩rmula utilizada, junto con el resumen estad칤stico.

1. **La f칩rmula** permite comprobar si se ha incluido o no la interacci칩n entre grupo y timepoint, y si se trata de un modelo con efectos aleatorios (`lme()` o `lmer()`) o sin ellos (`lm()`).
  
2. **El resumen del modelo** (`summary`) incluye:

- Los coeficientes estimados para cada t칠rmino (intercepto, grupo, timepoint, interacci칩n).

  El **intercepto** representa el valor esperado para el grupo y timepoint de referencia. Los coeficientes de grupo y tiempo muestran la diferencia respecto al grupo y timepoint de referencia.
  Si hay interacci칩n, los coeficientes reflejan c칩mo cambia el efecto de un factor en funci칩n del otro.

- Sus errores est치ndar, valores *t* y *p*-valores.

  仇듈mportante: presta atenci칩n a los coeficientes significativos (*p* < 0,05), ya que indican efectos estad칤sticamente relevantes.

- En `lme()` y `lmer()`, tambi칠n incluye el n칰mero de niveles del efecto aleatorio.

- En `lme()` se muestra el valor del logLik, junto con los criterios de informaci칩n AIC y BIC. Estos indicadores son 칰tiles para comparar modelos que solo difieren en la estructura de correlaci칩n entre residuos o en la estructura de la varianza residual: AIC y BIC penalizan la complejidad del modelo y cuanto **m치s bajos**, mejor; mientras que logLik mide el ajuste y cuanto **m치s alto**, mejor.

游눠 Nota: puedes probar distintas combinaciones de estructuras (por ejemplo, AR(1) con `varIdent` por grupo) y comparar los valores de AIC/BIC con otras opciones. Esto te ayudar치 a seleccionar el mejor modelo.


## Comparaci칩n de modelos (interacci칩n)

Independientemente de lo seleccionado en el men칰 de interacci칩n, aqu칤 se muestra la comparaci칩n entre ajustar el modelo con o sin interacci칩n entre grupo y *timepoint*. Un *p*-valor <0,05 sugiere que el modelo con interacci칩n se ajusta mejor, lo que indicar칤a que la evoluci칩n temporal difiere entre grupos. Por lo tanto, esta pesta침a permite valorar si es necesario interpretar el modelo completo (con interacci칩n) o si puede usarse una versi칩n m치s sencilla sin ella.


## Matriz varianza-covarianza

En esta aplicaci칩n el 칰nico efecto aleatorio incluido es el intercepto por sujeto (ID_sujeto) (en `lme()` y en `lmer()`), por lo que no aparecer치n las covarianzas. El *output* muestra:

1. La desviaci칩n est치ndar del intercepto aleatorio, es decir, variabilidad entre sujetos en su nivel basal. Si la desviaci칩n est치ndar del intercepto es cercana a 0, significa que no se detecta variabilidad sistem치tica entre sujetos en ese nivel. Pero el efecto aleatorio puede seguir siendo importante para modelar la dependencia entre observaciones repetidas de un mismo sujeto, por ejemplo, puede ser que los valores sean iguales a d칤a 0 para todos los sujetos pero no a d칤a 60.
  
2. La desviaci칩n est치ndar del residuo, que refleja la variabilidad no explicada por el modelo.
  
游눠 Nota: en modelos `lme()` tambi칠n se muestra la varianza correspondiente a cada componente.


## Comparaciones entre grupos

Muestra las medias estimadas y los contrastes calculados a partir del modelo ajustado:

1. Medias estimadas:
  
- Medias globales por grupo: promedia los valores estimados en todos los *timepoints* para cada grupo.
    
Solo disponible en modelos `lme()` o `lmer()`:
    
- Medias por grupo dentro de cada timepoint: 칰til para ver c칩mo difieren los grupos en cada momento del estudio.
  
- Medias por *timepoint* dentro de cada grupo: permite ver c칩mo evoluciona cada grupo a lo largo del tiempo.

2. Contrastes de medias estimadas con sus errores est치ndar, intervalos de confianza y *p*-valores:

- Comparaciones globales entre grupos.

Solo disponible en modelos `lme()` o `lmer()`:
    
- Comparaciones entre grupos dentro de cada *timepoint*.
    
- Comparaciones entre timepoints dentro de cada grupo.


## Gr치fico de comparaciones

Muestra visualmente las comparaciones entre medias estimadas. Seg칰n el modelo ajustado, se pueden ver los gr치ficos de:

1. Comparaci칩n global entre grupos: comparaci칩n de medias promediadas en todos los timepoints.
  
Solo disponible en modelos `lme()` o `lmer()`:

2. Comparaciones entre grupos por timepoint: 칰til para detectar diferencias entre tratamientos en cada momento del estudio.
  
3. Comparaciones entre timepoints por grupo: permite observar la evoluci칩n temporal dentro de cada grupo.
  

## Diagn칩sticos textuales

Muestra el resultado de pruebas estad칤sticas que eval칰an los principales supuestos del modelo: normalidad de los residuos, homocedasticidad (igualdad de varianzas) e independencia.

En modelos `lm`:

1. Normalidad: se aplican los tests de Shapiro-Wilk y Kolmogorov-Smirnov.

2. Homocedasticidad: se utiliza el test de Breusch-Pagan.

3. Independencia: se realiza el test de Durbin-Watson, 칰til para detectar autocorrelaci칩n en los residuos.

仇듈mportante: si los *p*-valores son > 0,05 no hay evidencia para rechazar los supuestos (es decir, se consideran como cumplidos).

En modelos `lmer()`/`lme()`:

1. Normalidad: se aplican igualmente los tests de Shapiro-Wilk y Kolmogorov-Smirnov sobre los residuos marginales.
2. Homocedasticidad: se eval칰a mediante el test de Levene (comparaci칩n de varianzas entre grupos).


Recomendaciones si se detectan problemas:

- Si los residuos **no son normales**, se puede considerar una **transformaci칩n** de la variable dependiente (logar칤tmica, ra칤z cuadrada, Box-Cox) y volver a cargar los datos para repetir el an치lisis.
  
- Si en LMM hay **heterocedasticidad** (varianzas desiguales), se recomienda utilizar un modelo `lme()` con una estructura de varianza residual m치s flexible (varIdent, varPower, etc.).


## Diagn칩sticos gr치ficos

Muestra una serie de gr치ficos dise침ados para evaluar visualmente si se cumplen los supuestos del modelo ajustado.

1. Histograma de residuos: permite observar si los residuos siguen una distribuci칩n aproximadamente normal.
  仇듈mportante:  una forma similar a la curva roja (gaussiana) sugiere normalidad.

2. Gr치fico Q-Q de residuos: muestra si los residuos se alinean con una distribuci칩n normal te칩rica.  
  仇듈mportante: los puntos alineados en la diagonal indican normalidad.

3. Gr치fico Q-Q de efectos aleatorios *(solo en `lme()`/`lmer()`)*: permite evaluar si los efectos aleatorios tambi칠n siguen una distribuci칩n normal.  
  仇듈mportante: los puntos alineados en la diagonal indican normalidad.

4. Residuos vs. valores ajustados: permite detectar posibles patrones en los residuos.  
  仇듈mportante: una nube aleatoria y sin forma definida indica homocedasticidad.

5. Gr치fico de autocorrelaci칩n de residuos: 칰til para comprobar si los residuos est치n correlacionados en el tiempo (especialmente relevante en datos longitudinales).  
  仇듈mportante: las barras dentro de la banda azul indican ausencia de autocorrelaci칩n.

Estos gr치ficos complementan los diagn칩sticos textuales y pueden revelar problemas no detectados por los tests estad칤sticos (o viceversa).


---

# **Contacto y soporte**

Para cualquier duda o mejora, puede contactar con la autora en **almoros@uoc.edu**.

---

